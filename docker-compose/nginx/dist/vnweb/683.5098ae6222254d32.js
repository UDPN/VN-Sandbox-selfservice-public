"use strict";(self.webpackChunkudpn_tem2=self.webpackChunkudpn_tem2||[]).push([[683],{2201:(w,v,a)=>{a.d(v,{k:()=>T});var y=a(8776),s=a(5e3),c=a(2290),h=a(7423),C=a(5245),S=a(9772),P=a(1062);const d=["upFile"];let T=(()=>{class l extends y.fS{constructor(t){super(),this.toastr=t}uploadFile(t){"text/plain"===t.target.files[0].type?new Promise((m,O)=>{const p=new FileReader;p.onload=()=>{p.result?m(p.result.toString()):this.showErrors("file content is empty!")},p.readAsText(t.target.files[0],"utf-8")}).then(m=>{if(this.fileDom.nativeElement.value="",this.isJSON(m)){this.model.Document=m;var O=JSON.parse(m),p=JSON.stringify(O,void 0,4);this.form.get("udpnDidDocument").setValue(p)}else this.showErrors("File format error!")}):this.showErrors("File format error!")}isJSON(t){if("string"==typeof t){const f=JSON.parse(t);return!("object"!=typeof f||!f)}return!1}showErrors(t){this.toastr.error(t,"error",{positionClass:"toast-bottom-center",progressBar:!0,progressAnimation:"decreasing"})}}return l.\u0275fac=function(t){return new(t||l)(s.Y36(c._W))},l.\u0275cmp=s.Xpm({type:l,selectors:[["formly-button"]],viewQuery:function(t,f){if(1&t&&s.Gf(d,5),2&t){let m;s.iGM(m=s.CRH())&&(f.fileDom=m.first)}},features:[s.qOj],decls:8,vars:6,consts:[["mat-stroked-button","","color","primary","type","button",1,"-mt-4",2,"width","100px","height","40px",3,"click"],["type","file","accept",".txt","hidden","",3,"change"],["upFile",""],["matTooltipPosition","right",2,"color","#333333ad","font-size","20px",3,"matTooltip"]],template:function(t,f){if(1&t){const m=s.EpF();s.TgZ(0,"button",0),s.NdJ("click",function(){return s.CHM(m),s.MAs(4).click()}),s._uU(1),s.ALo(2,"translate"),s.qZA(),s.TgZ(3,"input",1,2),s.NdJ("change",function(p){return f.uploadFile(p)}),s.qZA(),s.TgZ(5,"mat-icon",3),s.ALo(6,"translate"),s._uU(7,"help"),s.qZA()}2&t&&(s.xp6(1),s.Oqu(s.lcZ(2,2,"browse")),s.xp6(4),s.Q6J("matTooltip",s.lcZ(6,4,"onlineHelp.node")))},directives:[h.lW,C.Hw,S.gM],pipes:[P.X$],encapsulation:2}),l})()},1237:(w,v,a)=>{a.d(v,{X:()=>P});var y=a(8776),s=a(5e3),c=a(1062),h=a(3954),C=a(9808);function S(d,T){1&d&&(s.TgZ(0,"span",5),s._uU(1,"*"),s.qZA())}let P=(()=>{class d extends y.n2{constructor(l){super(),this.translate=l}}return d.\u0275fac=function(l){return new(l||d)(s.Y36(c.sK))},d.\u0275cmp=s.Xpm({type:d,selectors:[["formly-wrapper-panel"]],features:[s.qOj],decls:9,vars:5,consts:[["cols","4","gutterSize","0.8rem",3,"rowHeight"],[1,"font-sans","text-sm","-mt-4","whitespace-nowrap","text-right","font-bold"],["class","text-red-600",4,"ngIf"],["colspan","3"],["fieldComponent",""],[1,"text-red-600"]],template:function(l,g){1&l&&(s.TgZ(0,"mat-grid-list",0),s.TgZ(1,"mat-grid-tile"),s.TgZ(2,"div",1),s.YNc(3,S,2,0,"span",2),s.ALo(4,"translate"),s._uU(5),s.qZA(),s.qZA(),s.TgZ(6,"mat-grid-tile",3),s.GkF(7,null,4),s.qZA(),s.qZA()),2&l&&(s.Q6J("rowHeight",g.to.height||"70px"),s.xp6(3),s.Q6J("ngIf",g.to.required&&g.to.label!==s.lcZ(4,3,"unionist.public.nodeCode")),s.xp6(2),s.hij("",g.to.label," "))},directives:[h.Il,h.DX,C.O5],pipes:[c.X$],encapsulation:2}),d})()},6556:(w,v,a)=>{function y(s){return{validationMessages:[{name:"required",message:(c,h)=>s.stream("formly.required",{label:`${h.templateOptions.label||h.templateOptions.labels}`})}]}}a.d(v,{R:()=>y})},5683:(w,v,a)=>{a.r(v),a.d(v,{StrategyModule:()=>H});var y=a(9808),s=a(3767),c=a(5089),h=a(655),C=a(3075),S=a(6661),P=a(8746),d=a(1422),T=a(2192),l=a(4842),g=a(9637),t=a(5e3),f=a(2290),m=a(72),O=a(8966),p=a(1062),A=a(4004);let Z=(()=>{class n{}return n.list="v1/udpn/member/strategy/threshold/manage/searches",n.info="v1/udpn/member/strategy/threshold/manage/detail",n.add="v1/udpn/member/strategy/threshold/manage/save",n.submit="v1/udpn/member/strategy/threshold/manage/save/submit",n.getVnCount="v1/udpn/control/vote/proposal/manage/strategy/threshold/vn/count",n})();var _=a(520);let M=(()=>{class n{constructor(e){this.http=e}list(e){return this.http.post(Z.list,{inPage:e.inPage||{pageSize:10,pageNum:1}}).pipe((0,A.U)(i=>i))}info(e){return this.http.post(Z.info,{strategyId:e.strategyId||""}).pipe((0,A.U)(i=>i))}add(e){return this.http.post(Z.add,{strategyId:e.strategyId||"",newStrategyCountType:e.newStrategyCountType,newStrategyPassCount:e.newStrategyPassCount||"",remark:e.remark||""}).pipe((0,A.U)(i=>i))}submit(e){return this.http.post(Z.submit,{strategyId:e.strategyId||"",newStrategyCountType:e.newStrategyCountType,newStrategyPassCount:e.newStrategyPassCount||"",remark:e.remark||""}).pipe((0,A.U)(i=>i))}getVnCount(e){return this.http.post(Z.getVnCount,{}).pipe((0,A.U)(i=>i))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(_.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var F=a(2214),E=a(8776),L=a(7423);class x{constructor(o,e,r,i,u,b,k){this.toastr=o,this.spinner=e,this.location=r,this.dialog=i,this.translate=u,this.strategyService=b,this.store=k,this.app_create="strategy.list.newProposal",this.form=new C.cw({}),this.vnCount="",this.reg="^([1-9]|[1-9]\\d|100)$",this.strategyType="",this.strategyCountType=0,this.strategyPassCount="",this.model={newStrategyCountType:1},this.options={},this.fields=[{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.strategyType")},fieldGroup:[{type:"cDescription",key:"strategyType",expressionProperties:{"templateOptions.description":()=>this.strategyType}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.currentMethod")},fieldGroup:[{type:"cDescription",key:"strategyCountType",expressionProperties:{"templateOptions.description":()=>(new g.G).transform(this.strategyCountType,"strategy")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.currentValue")},fieldGroup:[{type:"cDescription",key:"strategyPassCount",expressionProperties:{"templateOptions.description":()=>this.strategyPassCount+(1===this.strategyCountType?"%":"")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],templateOptions:{required:!0},expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.newMethod")},fieldGroup:[{key:"newStrategyCountType",type:"select",className:"w-1/2",templateOptions:{change:(z,q)=>{this.reg=0===q.value?"^([1-"+this.vnCount+"]|"+this.vnCount+")$":"^([1-9]|[1-9]\\d|100)$",this.model.newStrategyCountType=z.model.newStrategyCountType,this.form.get("newStrategyPassCount").setValue("")},options:[{value:1,label:"By Percentage Of Votes"},{value:0,label:"By Votes"}],compareWith:this.compareIdObjects},expressionProperties:{"templateOptions.labels":this.translate.stream("strategy.list.newMethod")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],templateOptions:{required:!0},expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.newValue")},fieldGroup:[{key:"newStrategyPassCount",type:"cInput",className:"w-3/4",templateOptions:{required:!0},expressionProperties:{"templateOptions.labels":this.translate.stream("strategy.list.newValue"),"templateOptions.pattern":()=>this.reg},validation:{messages:{pattern:()=>0===this.model.newStrategyCountType?this.translate.stream("strategy.add.newValueByVotes",{value:`${this.vnCount}`}):this.translate.stream("strategy.add.newValueByPercentage")}}},{className:"ml-4 w-1/4",type:"code",key:"%",templateOptions:{label:"%"},hideExpression:"model.newStrategyCountType === 0"},{className:"ml-4",type:"cDescription",key:"vnCount",expressionProperties:{"templateOptions.description":()=>this.translate.instant("strategy.add.vnCount",{value:`${this.vnCount}`})},hideExpression:"model.newStrategyCountType !== 0"}]},{fieldGroupClassName:"flex formlyTextarea",wrappers:["panel"],templateOptions:{required:!0,height:"100px"},expressionProperties:{"templateOptions.label":this.translate.stream("strategy.list.description")},fieldGroup:[{key:"remark",type:"textarea",className:"w-full",templateOptions:{required:!0,maxLength:500},expressionProperties:{"templateOptions.labels":this.translate.stream("strategy.list.description")}}]}]}ngOnInit(){this.paramsSubscription=this.params$.subscribe(o=>{"{}"!==JSON.stringify(o.param)&&this.infoData(o.param.strategyId)})}compareIdObjects(o,e){return!(!e&&!o||e&&o.id!==e.id)}save(){this.spinner.show(),this.addSubscription=this.strategyService.add(this.model).pipe((0,P.x)(()=>this.spinner.hide())).subscribe(o=>{0!==o.code||this.dialog.open(d.h,{panelClass:"dialog-container-custom",data:{title:"Success",body:"Proposal added successfully!"}}).afterClosed().subscribe(r=>{r&&this.location.back()})})}submit(){this.spinner.show(),this.submitSubscription=this.strategyService.submit(this.model).pipe((0,P.x)(()=>this.spinner.hide())).subscribe(o=>{0!==o.code||this.dialog.open(d.h,{panelClass:"dialog-container-custom",data:{title:"Success",body:"Proposal submitted successfully!"}}).afterClosed().subscribe(r=>{r&&this.location.back()})})}infoData(o){this.getVnCountSubscription=this.strategyService.getVnCount({}).subscribe(e=>{0===e.code&&(this.vnCount=e.data,this.infoSubscription=this.strategyService.info({strategyId:o}).subscribe(r=>{0===r.code&&(this.strategyType=r.data.strategyType,this.strategyCountType=r.data.strategyCountType,this.strategyPassCount=r.data.strategyPassCount,this.form.get("newStrategyCountType").setValue(r.data.newStrategyCountType),this.form.get("newStrategyPassCount").setValue(r.data.newStrategyPassCount),this.form.get("remark").setValue(r.data.remark),this.model.strategyId=o,this.model.newStrategyCountType=1,this.reg=0===r.data.newStrategyCountType?"^([1-"+this.vnCount+"]|"+this.vnCount+")$":"^([1-9]|[1-9]\\d|100)$",this.model.newStrategyPassCount=this.form.get("newStrategyPassCount").value,this.model.remark=this.form.get("remark").value)}))})}ngOnDestroy(){var o,e,r,i,u;this.store.dispatch(new T.A({})),null===(o=this.paramsSubscription)||void 0===o||o.unsubscribe(),null===(e=this.addSubscription)||void 0===e||e.unsubscribe(),null===(r=this.submitSubscription)||void 0===r||r.unsubscribe(),null===(i=this.infoSubscription)||void 0===i||i.unsubscribe(),null===(u=this.getVnCountSubscription)||void 0===u||u.unsubscribe()}}x.\u0275fac=function(o){return new(o||x)(t.Y36(f._W),t.Y36(m.t2),t.Y36(y.Ye),t.Y36(O.uw),t.Y36(p.sK),t.Y36(M),t.Y36(S.yh))},x.\u0275cmp=t.Xpm({type:x,selectors:[["app-add"]],decls:13,vars:17,consts:[[3,"title"],[3,"formGroup"],[3,"model","fields","options","form"],[1,"flex","justify-end"],["mat-stroked-button","","color","primary","type","button","routerLink","../"],["mat-raised-button","","color","primary",1,"ml-4",3,"disabled","click"]],template:function(o,e){1&o&&(t.TgZ(0,"app-udpn-card",0),t.TgZ(1,"form",1),t.TgZ(2,"formly-form",2),t.TgZ(3,"div",3),t.TgZ(4,"button",4),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return e.save()}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return e.submit()}),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.Q6J("title",e.app_create),t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("model",e.model)("fields",e.fields)("options",e.options)("form",e.form),t.xp6(3),t.Oqu(t.lcZ(6,11,"back")),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(9,13,"save")),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(12,15,"submit")))},directives:[F.t,C._Y,C.JL,C.sg,E.T7,L.lW,c.rH],pipes:[p.X$],styles:[""]}),(0,h.gn)([(0,S.Ph)(l.s.param)],x.prototype,"params$",void 0);var D=a(9247),I=a(6852),N=a(7464);const J=function(n){return{"cursor-no-drop":n}},B=function(n){return{"pointer-events-none !text-gray-400":n}};function U(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"a",3),t.NdJ("click",function(){const u=t.CHM(e).data,b=t.oxw();return b.onJump(b.app_path_add,u.strategyId)}),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.qZA(),t.TgZ(5,"span",4),t._uU(6,"|"),t.qZA(),t.TgZ(7,"div",5),t.TgZ(8,"a",6),t.NdJ("click",function(){const u=t.CHM(e).data,b=t.oxw();return b.onProposal(b.app_path_proposal,u.strategyType)}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=o.data;t.xp6(1),t.Q6J("ngClass",t.VKq(8,J,!0!==e.newYn)),t.xp6(1),t.Q6J("ngClass",t.VKq(10,B,!0!==e.newYn)),t.xp6(1),t.Oqu(t.lcZ(4,4,"strategy.list.newProposal")),t.xp6(6),t.Oqu(t.lcZ(10,6,"proposalHistory"))}}const V=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:(()=>{class n{constructor(e,r,i,u){this.strategyService=e,this.sharedService=r,this.router=i,this.store=u,this.app_title="strategy.list.title",this.app_path_add=(new D.w).strategyAdd,this.app_path_proposal=(new D.w).proposalThresholdList,this.snapFilter=this.sharedService.getSnapFilter||{}}ngOnInit(){this.loadService(this.snapFilter)}loadService(e){this.subscription=this.strategyService.list(e).subscribe(r=>{this.dataSource=r.data,this.total=r.resultPageInfo.total,this.pagedata=[{tag:"No.",colunm:"No"},{tag:"strategy.list.strategyType",colunm:"strategyType",colunmData:"strategyType"},{tag:"strategy.list.currentMethod",colunm:"strategyCountType",colunmData:"strategyCountType",pip:"strategy"},{tag:"strategy.list.currentValue",colunm:"strategyPassCount",colunmData:"strategyPassCount"},{tag:"strategy.list.action",colunm:"Action"}]})}onJump(e,r){this.store.dispatch(new T.A({strategyId:r})).subscribe(i=>{this.router.navigate([e])})}onProposal(e,r){this.sharedService.setSnapFilter={strategyType:r},this.router.navigate([e])}fetchAll(e){this.snapFilter=Object.assign(Object.assign({},this.snapFilter),e),this.loadService(this.snapFilter)}ngOnDestroy(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(M),t.Y36(I.F),t.Y36(c.F0),t.Y36(S.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-list"]],decls:2,vars:4,consts:[[3,"title","dataSource","pagedata","t","toParentOk"],[1,"flex"],[1,"c-btn",3,"ngClass"],[1,"text-blue-900","font-semibold",3,"ngClass","click"],[1,"mr-4"],[1,"c-btn"],[1,"text-yellow-500","font-semibold",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"app-udpn-list",0),t.NdJ("toParentOk",function(u){return r.fetchAll(u)}),t.YNc(1,U,11,12,"ng-template"),t.qZA()),2&e&&t.Q6J("title",r.app_title)("dataSource",r.dataSource)("pagedata",r.pagedata)("t",r.total)},directives:[N.p,y.mk],pipes:[p.X$],styles:[""]}),n})()},{path:"add",component:x}];let W=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[c.Bz.forChild(V)],c.Bz]}),n})();var Y=a(7322),G=a(8554),R=a(1237),j=a(6556),K=a(4975),Q=a(977),$=a(2201),X=a(8009);let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[{provide:Y.o2,useValue:{appearance:"outline"}},{provide:E.l7,multi:!0,useFactory:j.R,deps:[p.sK]}],imports:[[s.m,y.ez,G.o,W,E.X0.forRoot({types:[{name:"cInput",component:K.N},{name:"code",component:X.x},{name:"cbutton",component:$.k},{name:"cDescription",component:Q.Q}],wrappers:[{name:"panel",component:R.X}]})]]}),n})()}}]);