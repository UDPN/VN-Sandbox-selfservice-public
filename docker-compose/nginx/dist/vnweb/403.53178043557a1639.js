"use strict";(self.webpackChunkudpn_tem2=self.webpackChunkudpn_tem2||[]).push([[403],{2201:(M,x,r)=>{r.d(x,{k:()=>Z});var C=r(8776),a=r(5e3),S=r(2290),p=r(7423),v=r(5245),T=r(9772),b=r(1062);const h=["upFile"];let Z=(()=>{class m extends C.fS{constructor(u){super(),this.toastr=u}uploadFile(u){"text/plain"===u.target.files[0].type?new Promise((g,y)=>{const d=new FileReader;d.onload=()=>{d.result?g(d.result.toString()):this.showErrors("file content is empty!")},d.readAsText(u.target.files[0],"utf-8")}).then(g=>{if(this.fileDom.nativeElement.value="",this.isJSON(g)){this.model.Document=g;var y=JSON.parse(g),d=JSON.stringify(y,void 0,4);this.form.get("udpnDidDocument").setValue(d)}else this.showErrors("File format error!")}):this.showErrors("File format error!")}isJSON(u){if("string"==typeof u){const f=JSON.parse(u);return!("object"!=typeof f||!f)}return!1}showErrors(u){this.toastr.error(u,"error",{positionClass:"toast-bottom-center",progressBar:!0,progressAnimation:"decreasing"})}}return m.\u0275fac=function(u){return new(u||m)(a.Y36(S._W))},m.\u0275cmp=a.Xpm({type:m,selectors:[["formly-button"]],viewQuery:function(u,f){if(1&u&&a.Gf(h,5),2&u){let g;a.iGM(g=a.CRH())&&(f.fileDom=g.first)}},features:[a.qOj],decls:8,vars:6,consts:[["mat-stroked-button","","color","primary","type","button",1,"-mt-4",2,"width","100px","height","40px",3,"click"],["type","file","accept",".txt","hidden","",3,"change"],["upFile",""],["matTooltipPosition","right",2,"color","#333333ad","font-size","20px",3,"matTooltip"]],template:function(u,f){if(1&u){const g=a.EpF();a.TgZ(0,"button",0),a.NdJ("click",function(){return a.CHM(g),a.MAs(4).click()}),a._uU(1),a.ALo(2,"translate"),a.qZA(),a.TgZ(3,"input",1,2),a.NdJ("change",function(d){return f.uploadFile(d)}),a.qZA(),a.TgZ(5,"mat-icon",3),a.ALo(6,"translate"),a._uU(7,"help"),a.qZA()}2&u&&(a.xp6(1),a.Oqu(a.lcZ(2,2,"browse")),a.xp6(4),a.Q6J("matTooltip",a.lcZ(6,4,"onlineHelp.node")))},directives:[p.lW,v.Hw,T.gM],pipes:[b.X$],encapsulation:2}),m})()},1237:(M,x,r)=>{r.d(x,{X:()=>b});var C=r(8776),a=r(5e3),S=r(1062),p=r(3954),v=r(9808);function T(h,Z){1&h&&(a.TgZ(0,"span",5),a._uU(1,"*"),a.qZA())}let b=(()=>{class h extends C.n2{constructor(m){super(),this.translate=m}}return h.\u0275fac=function(m){return new(m||h)(a.Y36(S.sK))},h.\u0275cmp=a.Xpm({type:h,selectors:[["formly-wrapper-panel"]],features:[a.qOj],decls:9,vars:5,consts:[["cols","4","gutterSize","0.8rem",3,"rowHeight"],[1,"font-sans","text-sm","-mt-4","whitespace-nowrap","text-right","font-bold"],["class","text-red-600",4,"ngIf"],["colspan","3"],["fieldComponent",""],[1,"text-red-600"]],template:function(m,t){1&m&&(a.TgZ(0,"mat-grid-list",0),a.TgZ(1,"mat-grid-tile"),a.TgZ(2,"div",1),a.YNc(3,T,2,0,"span",2),a.ALo(4,"translate"),a._uU(5),a.qZA(),a.qZA(),a.TgZ(6,"mat-grid-tile",3),a.GkF(7,null,4),a.qZA(),a.qZA()),2&m&&(a.Q6J("rowHeight",t.to.height||"70px"),a.xp6(3),a.Q6J("ngIf",t.to.required&&t.to.label!==a.lcZ(4,3,"unionist.public.nodeCode")),a.xp6(2),a.hij("",t.to.label," "))},directives:[p.Il,p.DX,v.O5],pipes:[S.X$],encapsulation:2}),h})()},6556:(M,x,r)=>{function C(a){return{validationMessages:[{name:"required",message:(S,p)=>a.stream("formly.required",{label:`${p.templateOptions.label||p.templateOptions.labels}`})}]}}r.d(x,{R:()=>C})},1403:(M,x,r)=>{r.r(x),r.d(x,{ProposalThresholdModule:()=>at});var C=r(9808),a=r(5089),S=r(655),p=r(3075),v=r(6661),T=r(8746),b=r(1422),h=r(2192),Z=r(4842),m=r(9637),t=r(5e3),u=r(2290),f=r(72),g=r(8966),y=r(1062),d=r(4004);let P=(()=>{class n{}return n.list="v1/udpn/control/vote/proposal/manage/strategy/threshold/searches",n.votingStrategyThresholdType="v1/udpn/control/vote/proposal/manage/strategy/threshold/type",n.info="v1/udpn/control/vote/proposal/manage/strategy/threshold/detail",n.vote="v1/udpn/control/proposal/vote",n.submit="v1/udpn/control/vote/proposal/manage/strategy/threshold/submit",n.editSubmit="v1/udpn/control/vote/proposal/manage/strategy/threshold/edit/submit",n.delete="v1/udpn/control/vote/proposal/manage/strategy/threshold/remove",n.getVnCount="v1/udpn/control/vote/proposal/manage/strategy/threshold/vn/count",n.save="v1/udpn/control/vote/proposal/manage/strategy/threshold/edit",n})();var B=r(520);let _=(()=>{class n{constructor(e){this.http=e}list(e){return this.http.post(P.list,{proposalCode:e.proposalCode||"",strategyType:e.strategyType||"",strategyCountType:e.strategyCountType||"",voteResult:e.voteResult,inPage:e.inPage||{pageSize:10,pageIndex:1}}).pipe((0,d.U)(i=>i))}votingStrategyThresholdType(e){return this.http.post(P.votingStrategyThresholdType,{}).pipe((0,d.U)(i=>i))}info(e){return this.http.post(P.info,{voteId:e.voteId||""}).pipe((0,d.U)(i=>i))}vote(e){return this.http.post(P.vote,{proposalCode:e.proposalCode||"",myselfResult:e.myselfResult||"",myselfRemark:e.myselfRemark||""}).pipe((0,d.U)(i=>i))}editSubmit(e){return this.http.post(P.editSubmit,{newStrategyCountType:e.newStrategyCountType,newStrategyPassCount:e.newStrategyPassCount||"",remark:e.remark||"",voteId:e.voteId||""}).pipe((0,d.U)(i=>i))}submit(e){return this.http.post(P.submit,{voteId:e.voteId||""}).pipe((0,d.U)(i=>i))}delete(e){return this.http.post(P.delete,{voteId:e.voteId||""}).pipe((0,d.U)(i=>i))}getVnCount(e){return this.http.post(P.getVnCount,{}).pipe((0,d.U)(i=>i))}save(e){return this.http.post(P.save,{voteId:e.voteId||"",newStrategyCountType:e.newStrategyCountType,newStrategyPassCount:e.newStrategyPassCount||"",remark:e.remark}).pipe((0,d.U)(i=>i))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(B.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var E=r(2214),L=r(8776),D=r(7423);class O{constructor(s,e,o,i,l,c,I){this.toastr=s,this.spinner=e,this.location=o,this.dialog=i,this.translate=l,this.proposalThresholdService=c,this.store=I,this.form=new p.cw({}),this.dataList={},this.proposalCode="",this.strategyType="",this.currentStrategyCountType=0,this.currentStrategyPassCount="",this.vnCount="",this.reg="^([1-9]|[1-9]\\d|100)$",this.model={},this.options={},this.fields=[{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.proposalCode")},fieldGroup:[{type:"cDescription",key:"proposalCode",expressionProperties:{"templateOptions.description":()=>this.proposalCode}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.votingStrategyType")},fieldGroup:[{type:"cDescription",key:"strategyType",expressionProperties:{"templateOptions.description":()=>this.strategyType}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.currentStrategyMethod")},fieldGroup:[{type:"cDescription",key:"currentStrategyCountType",expressionProperties:{"templateOptions.description":()=>(new m.G).transform(this.currentStrategyCountType,"strategy")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.currentPassValue")},fieldGroup:[{type:"cDescription",key:"currentStrategyPassCount",expressionProperties:{"templateOptions.description":()=>this.currentStrategyPassCount+(1===this.currentStrategyCountType?"%":"")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],templateOptions:{required:!0},expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.newStrategyMethod")},fieldGroup:[{key:"newStrategyCountType",type:"select",className:"w-1/2",templateOptions:{change:(J,rt)=>{this.reg=0===rt.value?"^([1-"+this.vnCount+"]|"+this.vnCount+")$":"^([1-9]|[1-9]\\d|100)$",this.model.newStrategyCountType=J.model.newStrategyCountType,this.form.get("newStrategyPassCount").setValue("")},options:[{value:1,label:"By Percentage Of Votes"},{value:0,label:"By Votes"}]},expressionProperties:{"templateOptions.labels":this.translate.stream("threshold.public.newStrategyMethod")}}]},{fieldGroupClassName:"flex justify-between",wrappers:["panel"],templateOptions:{required:!0},expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.newPassValue")},fieldGroup:[{key:"newStrategyPassCount",type:"cInput",className:"w-3/4",templateOptions:{required:!0},expressionProperties:{"templateOptions.labels":this.translate.stream("threshold.public.newPassValue"),"templateOptions.pattern":()=>this.reg},validation:{messages:{pattern:()=>1!==this.model.newStrategyCountType?this.translate.stream("threshold.add.newValueByVotes",{value:`${this.vnCount}`}):this.translate.stream("threshold.add.newValueByPercentage")}}},{className:"ml-4 w-1/4",type:"code",key:"%",templateOptions:{label:"%"},hideExpression:"model.newStrategyCountType  === 0"},{className:"ml-4",type:"cDescription",key:"vnCount",expressionProperties:{"templateOptions.description":()=>this.translate.instant("strategy.add.vnCount",{value:`${this.vnCount}`})},hideExpression:"model.newStrategyCountType !== 0"}]},{fieldGroupClassName:"flex formlyTextarea",wrappers:["panel"],templateOptions:{required:!0,height:"100px"},expressionProperties:{"templateOptions.label":this.translate.stream("threshold.public.description")},fieldGroup:[{key:"remark",type:"textarea",className:"w-full",templateOptions:{required:!0,maxLength:500},expressionProperties:{"templateOptions.labels":this.translate.stream("threshold.public.description")}}]}]}ngOnInit(){this.paramsSubscription=this.params$.subscribe(s=>{"{}"!==JSON.stringify(s.param)&&(this.app_edit=this.translate.stream("threshold.info.detail",{value:s.param.proposalCode}),this.infoData(s.param.voteId))})}save(){this.spinner.show(),this.addSubscription=this.proposalThresholdService.save(this.model).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(s=>{0!=s.code||this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"Success",body:"Proposal added successfully!"}}).afterClosed().subscribe(o=>{o&&this.location.back()})})}submit(){this.spinner.show(),this.submitSubscription=this.proposalThresholdService.editSubmit(this.model).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(s=>{0!==s.code||this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"Success",body:"Proposal submitted successfully!"}}).afterClosed().subscribe(o=>{o&&this.location.back()})})}infoData(s){this.getVnCountSubscription=this.proposalThresholdService.getVnCount({}).subscribe(e=>{0===e.code&&(this.vnCount=e.data,this.infoSubscription=this.proposalThresholdService.info({voteId:s}).subscribe(o=>{0===o.code&&(this.proposalCode=o.data.proposalCode,this.strategyType=o.data.strategyType,this.currentStrategyCountType=o.data.currentStrategyCountType,this.currentStrategyPassCount=o.data.currentStrategyPassCount,this.form.get("newStrategyCountType").setValue(o.data.newStrategyCountType),this.form.get("newStrategyPassCount").setValue(o.data.newStrategyPassCount),this.form.get("remark").setValue(o.data.remark),this.model.voteId=s,this.model.newStrategyCountType=this.form.get("newStrategyCountType").value,this.model.newStrategyPassCount=this.form.get("newStrategyPassCount").value,this.reg=0===o.data.newStrategyCountType?"^([1-"+this.vnCount+"]|"+this.vnCount+")$":"^([1-9]|[1-9]\\d|100)$",this.model.remark=this.form.get("remark").value)}))})}ngOnDestroy(){var s,e,o,i,l;this.store.dispatch(new h.A({})),null===(s=this.paramsSubscription)||void 0===s||s.unsubscribe(),null===(e=this.submitSubscription)||void 0===e||e.unsubscribe(),null===(o=this.addSubscription)||void 0===o||o.unsubscribe(),null===(i=this.infoSubscription)||void 0===i||i.unsubscribe(),null===(l=this.getVnCountSubscription)||void 0===l||l.unsubscribe()}}O.\u0275fac=function(s){return new(s||O)(t.Y36(u._W),t.Y36(f.t2),t.Y36(C.Ye),t.Y36(g.uw),t.Y36(y.sK),t.Y36(_),t.Y36(v.yh))},O.\u0275cmp=t.Xpm({type:O,selectors:[["app-edit"]],decls:14,vars:19,consts:[[3,"title"],[3,"formGroup"],[3,"model","fields","options","form"],[1,"flex","justify-end"],["mat-stroked-button","","color","primary","type","button","routerLink","../"],["mat-raised-button","","color","primary",1,"ml-4",3,"disabled","click"]],template:function(s,e){1&s&&(t.TgZ(0,"app-udpn-card",0),t.ALo(1,"async"),t.TgZ(2,"form",1),t.TgZ(3,"formly-form",2),t.TgZ(4,"div",3),t.TgZ(5,"button",4),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",5),t.NdJ("click",function(){return e.save()}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",5),t.NdJ("click",function(){return e.submit()}),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&s&&(t.Q6J("title",t.lcZ(1,11,e.app_edit)),t.xp6(2),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("model",e.model)("fields",e.fields)("options",e.options)("form",e.form),t.xp6(3),t.Oqu(t.lcZ(7,13,"back")),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(10,15,"save")),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(13,17,"submit")))},directives:[E.t,p._Y,p.JL,p.sg,L.T7,D.lW,a.rH],pipes:[C.Ov,y.X$],styles:[""]}),(0,S.gn)([(0,v.Ph)(Z.s.param)],O.prototype,"params$",void 0);var U=r(827);class A{constructor(s,e,o,i){this.spinner=s,this.translate=e,this.proposalThresholdService=o,this.store=i,this.dataShow=[]}ngOnInit(){this.paramsSubscription=this.params$.subscribe(s=>{"{}"!==JSON.stringify(s.param)&&this.infoData(s.param.voteId)})}infoData(s){this.spinner.show(),this.infoSubscription=this.proposalThresholdService.info({voteId:s}).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(e=>{this.dataShow=[[{label:"threshold.public.proposalCode",value:e.data.proposalCode},{label:"threshold.public.votingStrategyType",value:e.data.strategyType}],[{label:"threshold.public.currentStrategyMethod",value:e.data.currentStrategyCountType,type:"pip",pip:"strategy"},{label:"threshold.public.currentPassValue",value:e.data.currentStrategyPassCount+(1===e.data.currentStrategyCountType?"%":"")}],[{label:"threshold.public.newStrategyMethod",value:e.data.newStrategyCountType,type:"pip",pip:"strategy"},{label:"threshold.public.newPassValue",value:e.data.newStrategyPassCount+(1===e.data.newStrategyCountType?"%":"")}],[{label:"threshold.public.submission",value:e.data.createDate,type:"pip",pip:"date"},{label:"threshold.public.status",value:e.data.voteResult,type:"pip",pip:"voteResult"}],[{label:"threshold.public.description",value:e.data.remark,colspan:3,type:"html"}]]})}ngOnDestroy(){var s,e;this.store.dispatch(new h.A({})),null===(s=this.paramsSubscription)||void 0===s||s.unsubscribe(),null===(e=this.infoSubscription)||void 0===e||e.unsubscribe()}}A.\u0275fac=function(s){return new(s||A)(t.Y36(f.t2),t.Y36(y.sK),t.Y36(_),t.Y36(v.yh))},A.\u0275cmp=t.Xpm({type:A,selectors:[["app-info"]],decls:8,vars:4,consts:[["title","detail"],[3,"dataShow"],["tail",""],[1,"h-16"],["colspan","4",1,"text-right"],["mat-stroked-button","","color","primary","type","button","routerLink","../"]],template:function(s,e){1&s&&(t.TgZ(0,"app-udpn-card",0),t.TgZ(1,"app-udpn-info",1),t.ynx(2,2),t.TgZ(3,"tr",3),t.TgZ(4,"td",4),t.TgZ(5,"button",5),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.qZA(),t.qZA(),t.BQk(),t.qZA(),t.qZA()),2&s&&(t.xp6(1),t.Q6J("dataShow",e.dataShow),t.xp6(5),t.Oqu(t.lcZ(7,2,"back")))},directives:[E.t,U.m,D.lW,a.rH],pipes:[y.X$],styles:[""]}),(0,S.gn)([(0,v.Ph)(Z.s.param)],A.prototype,"params$",void 0);var R=r(9247),k=r(6852),Y=r(7464),F=r(1451),Q=r(5245);function W(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",1),t.TgZ(1,"mat-icon"),t._uU(2,"more_vert"),t.qZA(),t.qZA(),t.TgZ(3,"mat-menu",null,2),t.TgZ(5,"button",3),t.NdJ("click",function(){const l=t.CHM(e).data,c=t.oxw();return c.onJump(c.app_path_vote,l.voteId,l.proposalCode)}),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"button",3),t.NdJ("click",function(){const l=t.CHM(e).data,c=t.oxw();return c.onJump(c.app_path_edit,l.voteId,l.proposalCode)}),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"button",3),t.NdJ("click",function(){const l=t.CHM(e).data;return t.oxw().onSubmit(l.voteId)}),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"button",3),t.NdJ("click",function(){const l=t.CHM(e).data;return t.oxw().onDelete(l.voteId)}),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"button",4),t.NdJ("click",function(){const l=t.CHM(e).data,c=t.oxw();return c.onJump(c.app_path_info,l.voteId,l.proposalCode)}),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.qZA()}if(2&n){const e=s.data,o=t.MAs(4);t.Q6J("matMenuTriggerFor",o),t.xp6(5),t.Q6J("disabled",0!==e.voteResult||null!==e.myselfResult),t.xp6(1),t.Oqu(t.lcZ(7,10,"vote")),t.xp6(2),t.Q6J("disabled",2e3!==e.voteResult),t.xp6(1),t.Oqu(t.lcZ(10,12,"edit")),t.xp6(2),t.Q6J("disabled",2e3!==e.voteResult),t.xp6(1),t.Oqu(t.lcZ(13,14,"submit")),t.xp6(2),t.Q6J("disabled",2e3!==e.voteResult),t.xp6(1),t.Oqu(t.lcZ(16,16,"delete")),t.xp6(3),t.Oqu(t.lcZ(19,18,"detail"))}}let G=(()=>{class n{constructor(e,o,i,l,c,I,J){this.thresholdService=e,this.spinner=o,this.dialog=i,this.translateService=l,this.router=c,this.sharedService=I,this.store=J,this.app_title="threshold.list.title",this.app_title_fiter="threshold.list.fiter",this.app_path_info=(new R.w).proposalThresholdInfo,this.app_path_vote=(new R.w).proposalThresholdVote,this.app_path_edit=(new R.w).proposalThresholdEdit,this.snapFilter=this.sharedService.getSnapFilter||{},this.proposalOption=[],this.pagedata=[{tag:"threshold.public.proposalCode",colunm:"proposalCode",colunmData:"proposalCode"},{tag:"threshold.public.votingStrategyType",colunm:"strategyType",colunmData:"strategyType"},{tag:"threshold.public.newStrategyMethod",colunm:"strategyCountType",colunmData:"strategyCountType",pip:"strategy"},{tag:"threshold.public.newPassValue",colunm:"strategyPassCount",colunmData:"strategyPassCount"},{tag:"threshold.public.fromVN",colunm:"fromVnName",colunmData:"fromVnName"},{tag:"threshold.public.status",colunm:"voteResult",colunmData:"voteResult",pip:"voteResult"},{tag:"threshold.public.myVote",colunm:"myselfResult",colunmData:"myselfResult",pip:"voteStatus"},{tag:"threshold.list.action",colunm:"Action"}],this.dataFilter=[{name:"proposalCode",tag:"threshold.public.proposalCode",type:"input",maxLen:24},{name:"strategyType",tag:"threshold.public.votingStrategyType",type:"select",option:this.proposalOption},{name:"strategyCountType",tag:"threshold.public.votingStrategyMethod",type:"select",option:[{label:"strategyMethod.all",val:""},{label:"strategyMethod.byVotes",val:0},{label:"strategyMethod.byPercentage",val:1}]},{name:"voteResult",tag:"threshold.public.status",type:"select",option:[{label:"proposalStatus.all",val:""},{label:"proposalStatus.init",val:2e3},{label:"proposalStatus.pending",val:0},{label:"proposalStatus.approved",val:1},{label:"proposalStatus.rejected",val:2}]}]}ngOnInit(){this.typeSubscription=this.thresholdService.votingStrategyThresholdType({}).subscribe(e=>{e.data.forEach(i=>{this.proposalOption.push({label:i.strategyType,val:i.strategyType})}),this.proposalOption.unshift({label:"ALL",val:""})}),this.loadService(this.snapFilter)}loadService(e){this.subscription=this.thresholdService.list(e).subscribe(o=>{this.dataSource=o.data,this.total=o.resultPageInfo.total})}fetchAll(e){if(e.hasOwnProperty("type")&&"search"===e.type)return e.data.inPage={pageSize:10,pageNum:1},this.snapFilter=Object.assign(Object.assign({},this.snapFilter),e.data),void this.loadService(this.snapFilter);this.snapFilter=Object.assign(Object.assign({},this.snapFilter),e),this.loadService(this.snapFilter)}init(){this.snapFilter={},this.loadService(this.snapFilter)}onSubmit(e){this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"Prompt",body:"Are you sure you want to submit this proposal?"}}).afterClosed().subscribe(i=>{i&&(this.spinner.show(),this.submitSubscription=this.thresholdService.submit({voteId:e}).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(l=>{0!==l.code||this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"success",body:"Submit successfully!"}}).afterClosed().subscribe(()=>{this.init()})}))})}onDelete(e){this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"Delete",body:"Are you sure you want to delete this proposal?"}}).afterClosed().subscribe(i=>{i&&(this.deleteSubscription=this.thresholdService.delete({voteId:e}).subscribe(l=>{0!==l.code||this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"success",body:"Delete successfully!"}}).afterClosed().subscribe(()=>{this.init()})}))})}onJump(e,o,i){this.store.dispatch(new h.A({voteId:o,proposalCode:i})).subscribe(l=>{this.router.navigate([e])})}ngOnDestroy(){var e,o,i,l;null===(e=this.subscription)||void 0===e||e.unsubscribe(),null===(o=this.typeSubscription)||void 0===o||o.unsubscribe(),null===(i=this.submitSubscription)||void 0===i||i.unsubscribe(),null===(l=this.deleteSubscription)||void 0===l||l.unsubscribe(),this.sharedService.setSnapFilter={}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_),t.Y36(f.t2),t.Y36(g.uw),t.Y36(y.sK),t.Y36(a.F0),t.Y36(k.F),t.Y36(v.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-list"]],decls:2,vars:6,consts:[[3,"title_fiter","title","dataSource","pagedata","dataFilter","t","toParentOk","toParentCal"],["mat-icon-button","","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",1,"c-hover",3,"disabled","click"],["mat-menu-item","",1,"c-hover",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"app-udpn-list",0),t.NdJ("toParentOk",function(l){return o.fetchAll(l)})("toParentCal",function(){return o.init()}),t.YNc(1,W,20,20,"ng-template"),t.qZA()),2&e&&t.Q6J("title_fiter",o.app_title_fiter)("title",o.app_title)("dataSource",o.dataSource)("pagedata",o.pagedata)("dataFilter",o.dataFilter)("t",o.total)},directives:[Y.p,D.lW,F.p6,Q.Hw,F.VK,F.OP],pipes:[y.X$],styles:[""]}),n})();var N=r(9814),V=r(7322),j=r(8833);class w{constructor(s,e,o,i,l,c){this.spinner=s,this.formBuilder=e,this.dialog=o,this.lacation=i,this.proposalThresholdService=l,this.store=c,this.dataShow=[],this.form=new p.cw({}),this.infoDatas={},this.initFormBuilder()}ngOnInit(){this.paramsSubscription=this.params$.subscribe(s=>{"{}"!==JSON.stringify(s.param)&&this.infoData(s.param.voteId)})}initFormBuilder(){this.form=this.formBuilder.group({myselfRemark:["",[p.kI.required]],myselfResult:["true",[p.kI.required]]})}infoData(s){this.spinner.show(),this.infoSubscription=this.proposalThresholdService.info({voteId:s}).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(e=>{this.infoDatas=e.data,this.dataShow=[[{label:"threshold.public.proposalCode",value:e.data.proposalCode},{label:"threshold.public.votingStrategyType",value:e.data.strategyType}],[{label:"threshold.public.currentStrategyMethod",value:e.data.currentStrategyCountType,type:"pip",pip:"strategy"},{label:"threshold.public.currentPassValue",value:e.data.currentStrategyPassCount+(1===e.data.currentStrategyCountType?"%":"")}],[{label:"threshold.public.newStrategyMethod",value:e.data.newStrategyCountType,type:"pip",pip:"strategy"},{label:"threshold.public.newPassValue",value:e.data.newStrategyPassCount+(1===e.data.newStrategyCountType?"%":"")}],[{label:"threshold.public.submission",value:e.data.createDate,type:"pip",pip:"date"},{label:"threshold.public.status",value:e.data.voteResult,type:"pip",pip:"voteResult"}],[{label:"threshold.public.description",value:e.data.remark,colspan:3,type:"html"}]]})}submit(){this.spinner.show(),this.voteSubscription=this.proposalThresholdService.vote({myselfResult:this.form.get("myselfResult").value,proposalCode:this.infoDatas.proposalCode,myselfRemark:this.form.get("myselfRemark").value}).pipe((0,T.x)(()=>this.spinner.hide())).subscribe(s=>{0!==s.code||this.dialog.open(b.h,{panelClass:"dialog-container-custom",data:{title:"success",body:"vote successfully!"}}).afterClosed().subscribe(o=>{o&&this.lacation.back()})})}ngOnDestroy(){var s,e,o;this.store.dispatch(new h.A({})),null===(s=this.paramsSubscription)||void 0===s||s.unsubscribe(),null===(e=this.infoSubscription)||void 0===e||e.unsubscribe(),null===(o=this.voteSubscription)||void 0===o||o.unsubscribe()}}w.\u0275fac=function(s){return new(s||w)(t.Y36(f.t2),t.Y36(p.qu),t.Y36(g.uw),t.Y36(C.Ye),t.Y36(_),t.Y36(v.yh))},w.\u0275cmp=t.Xpm({type:w,selectors:[["app-vote"]],decls:36,vars:21,consts:[["title","vote"],[3,"formGroup"],[3,"dataShow"],["tail",""],[1,"h-20"],[1,"text-right","font-sans","text-sm","font-bold","pr-3","w-1/5"],[1,"text-red-600"],["colspan","3"],["formControlName","myselfResult"],["value","true","checked","true",1,"mr-8"],["value","false",1,"second"],["appearance","outline",1,"w-full"],["matInput","","placeholder","comments","formControlName","myselfRemark",1,"!ring-transparent","h-12"],[1,"h-16"],["colspan","4",1,"text-right"],["mat-stroked-button","","color","primary","type","button","routerLink","../"],["mat-raised-button","","color","primary",1,"ml-4",3,"disabled","click"]],template:function(s,e){1&s&&(t.TgZ(0,"app-udpn-card",0),t.TgZ(1,"form",1),t.TgZ(2,"app-udpn-info",2),t.ynx(3,3),t.TgZ(4,"tr",4),t.TgZ(5,"td",5),t.TgZ(6,"span",6),t._uU(7,"*"),t.qZA(),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"td",7),t.TgZ(11,"mat-radio-group",8),t.TgZ(12,"mat-radio-button",9),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"mat-radio-button",10),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"tr"),t.TgZ(19,"td",5),t.TgZ(20,"span",6),t._uU(21,"*"),t.qZA(),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"td",7),t.ynx(25),t.TgZ(26,"mat-form-field",11),t._UZ(27,"textarea",12),t.qZA(),t.BQk(),t.qZA(),t.qZA(),t.TgZ(28,"tr",13),t.TgZ(29,"td",14),t.TgZ(30,"button",15),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"button",16),t.NdJ("click",function(){return e.submit()}),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.qZA(),t.qZA(),t.BQk(),t.qZA(),t.qZA(),t.qZA()),2&s&&(t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("dataShow",e.dataShow),t.xp6(6),t.Oqu(t.lcZ(9,9,"threshold.public.votingResult")),t.xp6(5),t.Oqu(t.lcZ(14,11,"agree")),t.xp6(3),t.Oqu(t.lcZ(17,13,"disagree")),t.xp6(6),t.Oqu(t.lcZ(23,15,"threshold.public.comments")),t.xp6(9),t.Oqu(t.lcZ(32,17,"back")),t.xp6(2),t.Q6J("disabled",!e.form.valid),t.xp6(1),t.Oqu(t.lcZ(35,19,"save")))},directives:[E.t,p._Y,p.JL,p.sg,U.m,N.VQ,p.JJ,p.u,N.U0,V.KE,j.Nt,p.Fj,D.lW,a.rH],pipes:[y.X$],styles:[""]}),(0,S.gn)([(0,v.Ph)(Z.s.param)],w.prototype,"params$",void 0);const K=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:G},{path:"info",component:A},{path:"vote",component:w},{path:"edit",component:O}];let $=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[a.Bz.forChild(K)],a.Bz]}),n})();var q=r(3767),X=r(1237),H=r(6556),z=r(8554),tt=r(4975),et=r(977),ot=r(2201),st=r(8009);let at=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[{provide:V.o2,useValue:{appearance:"outline"}},{provide:L.l7,multi:!0,useFactory:H.R,deps:[y.sK]}],imports:[[C.ez,q.m,z.o,$,L.X0.forRoot({types:[{name:"cInput",component:tt.N},{name:"cbutton",component:ot.k},{name:"cDescription",component:et.Q},{name:"code",component:st.x}],wrappers:[{name:"panel",component:X.X}]})]]}),n})()}}]);